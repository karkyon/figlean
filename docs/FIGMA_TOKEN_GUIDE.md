# =====================================
# Figmaãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ï¼†è¨­å®šã‚¬ã‚¤ãƒ‰
# FIGLEAN API ãƒ†ã‚¹ãƒˆå®Œå…¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
# =====================================

## ğŸ“‹ ç›®æ¬¡

1. Figmaãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—æ–¹æ³•
2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. å®Ÿè¡Œæ–¹æ³•
4. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

---

## ğŸ”‘ 1. Figmaãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—æ–¹æ³•

### Step 1: Figmaã«ãƒ­ã‚°ã‚¤ãƒ³

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://www.figma.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³

### Step 2: Personal Access Token ã‚’ç”Ÿæˆ

1. https://www.figma.com/settings ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ **"Account"** ã‚¿ãƒ–ã‚’é¸æŠ
3. **"Personal access tokens"** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
4. **"Create a new personal access token"** ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 3: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š

1. **Token name**: `FIGLEAN Test` ã¨å…¥åŠ›
2. **Scopes**: 
   - âœ… **File content (read-only)** ã«ãƒã‚§ãƒƒã‚¯
   - ã“ã‚Œã ã‘ã§ååˆ†ã§ã™ï¼ˆæ›¸ãè¾¼ã¿æ¨©é™ã¯ä¸è¦ï¼‰
3. **"Generate token"** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 4: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼

âš ï¸ **é‡è¦**: ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼

```
ä¾‹: figd_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®‰å…¨ãªå ´æ‰€ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ¯ 2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/projects/figlean

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .env.test << 'EOF'
# FIGLEAN APIè¨­å®š
API_BASE_URL=http://localhost:3101

# Figmaãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå¿…é ˆï¼‰
FIGMA_TOKEN=your-figma-token-here

# ãƒ†ã‚¹ãƒˆç”¨Figmaãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# ä¾‹: https://www.figma.com/file/ABC123DEF456/MyDesign
# â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ã¯ "ABC123DEF456"
FIGMA_FILE_KEY=

# ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
TEST_EMAIL=test-$(date +%s)@figlean.test
TEST_PASSWORD=TestPass123!
TEST_NAME="FIGLEANãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼"
EOF

# .env.testãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦å®Ÿéš›ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
nano .env.test
```

### Figmaãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ã®å–å¾—æ–¹æ³•ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ãƒ†ã‚¹ãƒˆç”¨ã®Figmaãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ï¼š

1. Figmaã§ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
2. URLã‚’ç¢ºèª:
   ```
   https://www.figma.com/file/ABC123DEF456/MyDesignFile
                              ^^^^^^^^^^^^
                              ã“ã‚ŒãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼
   ```
3. `ABC123DEF456` ã®éƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒ¼
4. `.env.test` ã® `FIGMA_FILE_KEY` ã«è¨­å®š

---

## ğŸš€ 3. å®Ÿè¡Œæ–¹æ³•

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸

```bash
cd ~/projects/figlean
chmod +x test-figlean-api.sh
```

### ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚“ã§å®Ÿè¡Œ

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã¿
source .env.test

# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
./test-figlean-api.sh
```

### ã¾ãŸã¯ã€ç›´æ¥æŒ‡å®šã—ã¦å®Ÿè¡Œ

```bash
FIGMA_TOKEN='your-token' \
FIGMA_FILE_KEY='your-file-key' \
./test-figlean-api.sh
```

---

## ğŸ“Š 4. å®Ÿè¡Œä¾‹

### æœ€å°æ§‹æˆï¼ˆFigmaãƒˆãƒ¼ã‚¯ãƒ³ã®ã¿ï¼‰

```bash
export FIGMA_TOKEN='figd_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
./test-figlean-api.sh
```

ã“ã®å ´åˆã€ä»¥ä¸‹ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¾ã™ï¼š
- âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- âœ… ãƒ­ã‚°ã‚¤ãƒ³
- âœ… Figmaãƒˆãƒ¼ã‚¯ãƒ³è¨­å®š
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- âœ… Figmaãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
- âœ… Figmaãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
- âš ï¸ Figmaã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ãªã—ï¼‰
- âœ… è¨ºæ–­çµæœå–å¾—ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤

### å®Œå…¨ãƒ†ã‚¹ãƒˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ï¼‰

```bash
export FIGMA_TOKEN='figd_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
export FIGMA_FILE_KEY='ABC123DEF456'
./test-figlean-api.sh
```

ã“ã®å ´åˆã€ä»¥ä¸‹ãŒè¿½åŠ ã§ãƒ†ã‚¹ãƒˆã•ã‚Œã¾ã™ï¼š
- âœ… Figmaãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°å–å¾—
- âœ… Figmaã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ
- âœ… ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–
- âœ… è¨ºæ–­çµæœå–å¾—ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ï¼‰
- âœ… ãƒ«ãƒ¼ãƒ«é•åå–å¾—
- âœ… å´©å£Šäºˆæ¸¬å–å¾—
- âœ… æ”¹å–„ææ¡ˆå–å¾—
- âœ… Figmaã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿ï¼‰

---

## ğŸ”§ 5. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: Figmaãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹

**ç—‡çŠ¶**:
```
[âœ—] Client error (HTTP 403)
{
  "error": {
    "code": "FIGMA_TOKEN_INVALID",
    "message": "Figma token is invalid or expired"
  }
}
```

**è§£æ±ºæ–¹æ³•**:
1. ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ãªã„ã‹ç¢ºèª
3. æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦å†åº¦è¨­å®š

---

### å•é¡Œ2: Figmaãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ãŒç„¡åŠ¹

**ç—‡çŠ¶**:
```
[âœ—] Client error (HTTP 404)
{
  "error": {
    "code": "FIGMA_FILE_NOT_FOUND",
    "message": "Figma file not found"
  }
}
```

**è§£æ±ºæ–¹æ³•**:
1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèª
2. ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚‹ã‹ç¢ºèª
3. ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª

---

### å•é¡Œ3: APIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ããªã„

**ç—‡çŠ¶**:
```
curl: (7) Failed to connect to localhost port 3101
```

**è§£æ±ºæ–¹æ³•**:
```bash
# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
cd ~/projects/figlean
docker-compose ps

# èµ·å‹•ã—ã¦ã„ãªã„å ´åˆ
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f backend
```

---

### å•é¡Œ4: ã‚¸ãƒ§ãƒ–ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**ç—‡çŠ¶**:
```
[!] Import job timeout (waited 300s)
```

**è§£æ±ºæ–¹æ³•**:
1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°ã‚’ç¢ºèª:
   ```bash
   docker-compose logs -f backend | grep -i error
   ```
2. Figmaãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª

---

## ğŸ“ 6. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã”ã¨ã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```bash
# ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
ls -la ./test-logs/

# æœ€æ–°ã®ãƒ­ã‚°ã‚’ç¢ºèª
cat ./test-logs/figlean-api-test-*.log | tail -100

# ã‚¨ãƒ©ãƒ¼ã®ã¿æŠ½å‡º
cat ./test-logs/figlean-api-test-*.log | grep -E '\[âœ—\]|\[!\]'
```

---

## ğŸ¯ 7. æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹

### æˆåŠŸæ™‚ï¼ˆå®Œå…¨ãƒ†ã‚¹ãƒˆï¼‰

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ FIGLEAN Backend API Complete Test
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Configuration:
  API Base URL: http://localhost:3101
  Test Email: test-1704945600@figlean.test
  Log File: ./test-logs/figlean-api-test-20260112-103000.log

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Phase 1: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[INFO] ğŸ“¡ API Request: GET /api/health
[âœ“] Request succeeded (HTTP 200)
[âœ“] Health check passed

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Phase 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[INFO] ğŸ“¡ API Request: POST /api/auth/register
[âœ“] Request succeeded (HTTP 200)
[âœ“] User registered successfully
[INFO] User ID: 550e8400-e29b-41d4-a716-446655440000
[INFO] JWT Token: eyJhbGciOiJIUzI1NiIs...

...ï¼ˆä¸­ç•¥ï¼‰...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Phase 12: å´©å£Šäºˆæ¸¬å–å¾—
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[INFO] ğŸ“¡ API Request: GET /api/analysis/{projectId}/predictions
[âœ“] Request succeeded (HTTP 200)
[INFO] Total predictions: 3
[âœ“] Predictions retrieved successfully

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ‰ Test Completed Successfully
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Test Summary:
  API Base URL: http://localhost:3101
  Test User: test-1704945600@figlean.test
  Project ID: 6449e617-3462-46c9-a4fb-663663ffb09a (deleted)
  Log File: ./test-logs/figlean-api-test-20260112-103000.log

[âœ“] All tests passed! ğŸš€
```

---

## ğŸ” 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

âš ï¸ **é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–**:

1. **ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¬é–‹ã—ãªã„**
   - `.env.test` ã‚’ `.gitignore` ã«è¿½åŠ 
   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãªã„

2. **ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®šæœŸçš„ã«å†ç”Ÿæˆ**
   - ä½¿ç”¨å¾Œã¯å¤ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤

3. **æœ€å°æ¨©é™ã®åŸå‰‡**
   - Read-onlyæ¨©é™ã®ã¿ä»˜ä¸

```bash
# .gitignoreã«è¿½åŠ 
echo ".env.test" >> .gitignore
echo "test-logs/" >> .gitignore
```

---

## ğŸ“ 9. ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆï¼š

1. **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª**: `./test-logs/`
2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°ã‚’ç¢ºèª**: `docker-compose logs backend`
3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª**: `docker-compose logs db`

---

## ğŸ“ 10. ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|------|------|------|-----|
| `FIGMA_TOKEN` | âœ… | Figmaãƒˆãƒ¼ã‚¯ãƒ³ | `figd_XXX...` |
| `FIGMA_FILE_KEY` | âŒ | ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ | `ABC123DEF456` |
| `API_BASE_URL` | âŒ | APIãƒ™ãƒ¼ã‚¹URL | `http://localhost:3101` |
| `TEST_EMAIL` | âŒ | ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¼ãƒ« | `test@example.com` |
| `TEST_PASSWORD` | âŒ | ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | `TestPass123!` |

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# ç’°å¢ƒå¤‰æ•°è¨­å®š
export FIGMA_TOKEN='your-token'
export FIGMA_FILE_KEY='your-file-key'

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./test-figlean-api.sh

# ãƒ­ã‚°ç¢ºèª
cat ./test-logs/figlean-api-test-*.log | tail -50

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
docker-compose restart backend

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
docker-compose down -v
docker-compose up -d
```

---

**Happy Testing! ğŸš€**
